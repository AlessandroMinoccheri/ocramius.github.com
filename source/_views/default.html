<!DOCTYPE html>
<html>
    <head>
        <title>{% block title %}{{ page.title }}{% endblock %} &mdash; {{ site.title }} &mdash; {{ site.subtitle }}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="{{ site.url }}/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="{{ site.url }}/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="{{ site.url }}/font/stylesheet.css" rel="stylesheet" type="text/css" />
        <link href="{{ site.url }}/css/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="stylesheet" href="{{ site.url }}/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="{{ site.url }}/atom.xml" title="{{ site.title }} activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
        .container.logo-cont {height: 250px; width: 250px; background: transparent;}
        .container.logo-cont canvas {z-index: 2; pointer-events: none; background: transparent;}
        </style>
    </head>
    <body>
        <header>
            <div class="sidebar">

                <div class="logo">
                    <div id="shield-container" class="container logo-cont"></div>
                </div>

                <div class="main-navigator">
                    <ul class="nav">
                        <li><a href="{{ site.url }}/">Home</a></li>
                        <li><a href="{{ site.url }}/blog">Archive</a></li>
                        <li><a href="{{ site.url }}/blog/categories">Categories</a></li>
                        <li><a href="{{ site.url }}/blog/tags">Tags</a></li>
                        <li><a href="{{ site.url }}/about">About</a></li>
                    </ul>
                </div>
            </div>
        </header>
        <div class="mainContent container">
            <div class="row-fluid">
                <div class="span11 text-center">
                    <h1>Marco Pivetta</h1>
                    <p><i>Lorem ipsum dolor sit amet, consectetur adipisicing elit. A asperiores amet odit quo praesentium, commodi dicta voluptatem eius totam, quasi perferendis quaerat! Ratione quos iusto, incidunt porro, quod beatae eligendi.</i></p>   
                </div>
                <div class="span11 align-center">
                    <h1>{{ site.title }}</h1>
                    <p class="description"> {{ site.description }} </p>
                </div>
                <div class="span11">
                    {% block content_wrapper %}{% block content %}{% endblock %}{% endblock %}
                </div>
                <div class="span4 si debar"></div>
            </div>
        </div>

        <script src="{{ site.url }}/components/jquery/jquery.min.js"></script>
        <script src="{{ site.url }}/js/shifty.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>
        <script src="{{ site.url }}/components/bootstrap/js/bootstrap.min.js"></script>
        {% block scripts %}
        {% endblock %}

        {% if site.google_analytics_tracking_id %}

        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', '{site.google_analytics_tracking_id}', 'auto');
            ga('send', 'pageview');
        </script>
        {% endif %}
        <script src="{{ site.url }}/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="{{ site.url }}/js/three-js-object-loader.js">

    </script>
    <script>
        var container, $container;
        var renderer, camera, scene, light, pointLight;
        var shield;
        var shieldRotation = false,
            marios = [],
            currentMario = 0;
        function initMario() {

            init();
            animate();

            function init() {
                var VIEW_ANGLE = 45,
                    NEAR = 0.1,
                    FAR = 10000;

                $container = $('#shield-container');
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setClearColor( 0x000000, 0 );
                camera = new THREE.PerspectiveCamera(VIEW_ANGLE, $container.width() / $container.height(), NEAR, FAR);
                scene = new THREE.Scene();
                scene.add(camera);
                camera.position.x = 30;
                camera.position.y = 300;
                renderer.setSize($container.width(), $container.height());
                $container.append(renderer.domElement);
                pointLight = new THREE.PointLight(0xFFFFFF);
                pointLight.position.x = 50;
                pointLight.position.y = 200;
                pointLight.position.z = 30;
                scene.add(pointLight);

                texture = THREE.ImageUtils.loadTexture("{{ site.url }}/logo/mario/mario_tex.png");

                for (var i = 0; i < 12; i += 1) {
                    // encapsulating in a closure to avoid scope leakages on the iterator value
                    (function (i) {
                        (new THREE.OBJLoader())
                            .load("{{ site.url }}/logo/mario/Frame_" + (i + 1) + ".obj", function(geometries, materials) {
                                material = new THREE.MeshLambertMaterial({map: texture});
                                shield   = new THREE.Mesh(geometries.children[0].geometry, material);

                                shield.rotation.y = deg2rad(90);
                                shield.scale.set(10, 10, 10);
                                scene.add(shield);
                                shield.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(1.1, 0.5, 0));
                                shield.geometry.verticesNeedUpdate = true;
                                shield.visible = false;
                                marios[i] = shield;
                                renderer.render(scene, camera);
                            });
                    }(i));
                }
            }

            function animate() {
                requestAnimationFrame( animate);
                currentMario += 0.2;
                var currentMarioIndex = parseInt(currentMario) % 12;

                for (var i = 0; i < marios.length; i += 1) {
                    //marios[i].visible = (i === 0);
                    marios[i].visible = (i === currentMarioIndex);

                    marios[i].rotation.z += deg2rad(2);
                    if (marios[i].rotation.z > 2 * Math.PI) {
                        marios[i].rotation.z = 0;
                    }
                }

                if (shieldRotation) {
                    shield.rotation.y += deg2rad(5);
                    if (shield.rotation.y > 2 * Math.PI) {
                        shield.rotation.y = 0;
                    }
                }
                render();
            }

            function render() {
                camera.lookAt( scene.position );

                renderer.render( scene, camera );
            }
        }
    </script>
    <script>
        window.deg2rad = function(deg) { return deg * (Math.PI / 180); };
        initMario();
    </script>
    </body>
</html>
